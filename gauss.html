<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Método de Gauss — Passo a Passo</title>
  <style>
    body { font-family: Arial, sans-serif; background:#f5f5f5; padding:20px; }
    .container { background:#fff; padding:20px; border-radius:12px;
                 max-width:1000px; margin:auto; box-shadow:0 4px 12px rgba(0,0,0,.1); }
    input, button, textarea {
      margin:6px 0; padding:8px; width:100%; box-sizing:border-box;
      border-radius:8px; border:1px solid #ccc; font-size:14px;
    }
    button { background:#007bff; color:#fff; border:none; cursor:pointer; }
    button:hover { background:#0056b3; }
    h2, h3 { margin-top:0; }
    .row { display:grid; grid-template-columns:1fr 1fr; gap:12px; }
    .tables { display:grid; grid-template-columns:1fr 1fr; gap:16px; margin-top:16px; }
    .table-wrap { border:1px solid #eee; border-radius:8px; overflow:auto; max-height:380px; }
    table { width:100%; border-collapse:collapse; font-size:13px; }
    th, td { padding:6px 8px; border-bottom:1px solid #eee; text-align:right; }
    th { position:sticky; top:0; background:#fafafa; text-align:center; }
    td:first-child, th:first-child { text-align:center; }
    .result { font-weight:600; margin-top:10px; }
    .warn { color:#b44; font-weight:600; }
    code { background:#f2f4f7; padding:2px 6px; border-radius:6px; }
    .highlight { background:#ffeb99; }
  </style>
</head>
<body>

<div class="container">
  <h2>Método de Gauss (eliminação) — calculadora com etapas</h2>
  <p>Insira a <strong>matriz A</strong> e o <strong>vetor b</strong>. Use espaços entre números e quebras de linha para separar as linhas.</p>

  <label>Matriz A (coeficientes):</label>
  <textarea id="matrizA" rows="5">2 1 -1
-3 -1 2
-2 1 2</textarea>

  <label>Vetor b (termos independentes):</label>
  <input id="vetorB" value="8 -11 -3">

  <div class="row">
    <div>
      <label>Precisão de exibição (casas decimais)</label>
      <input id="prec" type="number" value="6" min="0" max="12">
    </div>
    <div>
      <label>Limite para considerar pivô nulo (tolerância)</label>
      <input id="eps" type="number" value="1e-12" step="1e-12">
    </div>
  </div>

  <button onclick="resolver()">Resolver</button>

  <div class="result" id="solucao"></div>

  <div class="tables">
    <div>
      <h3>Eliminação (triangulação)</h3>
      <div class="table-wrap" id="tblElim"></div>
    </div>
    <div>
      <h3>Substituição regressiva</h3>
      <div class="table-wrap" id="tblBack"></div>
    </div>
  </div>
</div>

<script>
function resolver() {
  const prec = parseInt(document.getElementById('prec').value);
  const eps = parseFloat(document.getElementById('eps').value);

  const A = document.getElementById('matrizA').value.trim().split('\n').map(row =>
    row.trim().split(/\s+/).map(Number)
  );
  const n = A.length;

  const b = document.getElementById('vetorB').value.trim().split(/\s+/).map(Number);
  if (b.length !== n) { alert("Vetor b deve ter o mesmo número de linhas que A"); return; }

  let M = A.map(r => r.slice());
  let B = b.slice();

  const tblElim = document.getElementById('tblElim');
  const tblBack = document.getElementById('tblBack');
  tblElim.innerHTML = '';
  tblBack.innerHTML = '';

  function criarTabela(mat, vec, highlightRow=-1, pivotCol=-1, factors=[]) {
    let html = '<table><tr><th>i</th>' + mat[0].map((_,j) => 'A['+j+']').join('') + '<th>b</th></tr>';
    for (let i = 0; i < mat.length; i++) {
      html += '<tr' + (i===highlightRow ? ' class="highlight"' : '') + '><td>' + i + '</td>';
      for (let j = 0; j < mat[i].length; j++) {
        let val = mat[i][j].toFixed(prec);
        if(i===highlightRow && j===pivotCol) val = '<b>'+val+'</b>';
        html += '<td>' + val + '</td>';
      }
      let bVal = vec[i].toFixed(prec);
      if(i===highlightRow && factors[i]!==undefined) bVal += ' ('+factors[i].toFixed(prec)+')';
      html += '<td>' + bVal + '</td></tr>';
    }
    html += '</table>';
    return html;
  }

  // Passo inicial
  tblElim.innerHTML += criarTabela(M,B) + '<br>';

  for (let k = 0; k < n-1; k++) {
    // Pivoteamento parcial
    let maxRow = k;
    for (let i = k+1; i < n; i++) {
        if (Math.abs(M[i][k]) > Math.abs(M[maxRow][k])) maxRow = i;
    }
    if (Math.abs(M[maxRow][k]) < eps) {
        alert(`Pivô nulo ou muito próximo de zero na coluna ${k}`);
        return;
    }
    if (maxRow !== k) {
        [M[k], M[maxRow]] = [M[maxRow], M[k]];
        [B[k], B[maxRow]] = [B[maxRow], B[k]];
    }

    const factors = Array(n).fill(undefined);
    for (let i = k+1; i < n; i++) {
        const factor = M[i][k] / M[k][k];
        factors[i] = factor;
        for (let j = k; j < n; j++) M[i][j] -= factor * M[k][j];
        B[i] -= factor * B[k];
    }
    tblElim.innerHTML += criarTabela(M,B,k,k,factors) + '<br>';
  }

  // Substituição regressiva
  let x = new Array(n).fill(0);
  for (let i = n-1; i >= 0; i--) {
    let sum = 0;
    for (let j = i+1; j < n; j++) sum += M[i][j]*x[j];
    if (Math.abs(M[i][i]) < eps) {
      alert(`Divisão por zero no passo regressivo linha ${i}`);
      return;
    }
    x[i] = (B[i] - sum)/M[i][i];

    // Tabela do passo atual
    const htmlStep = '<table><tr><th>x</th><th>Valor</th></tr>' +
                     x.map((val,j) => '<tr><td>x['+j+']</td><td>' + val.toFixed(prec) + '</td></tr>').join('') +
                     '</table><br>';
    tblBack.innerHTML += htmlStep;
  }

  document.getElementById('solucao').innerHTML = 'Solução final: ' + x.map(v => v.toFixed(prec)).join(', ');
}
</script>

</body>
</html>
