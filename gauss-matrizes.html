<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Gauss com Matrizes Elementares</title>
  <style>
    body { font-family: Arial, sans-serif; background:#f5f5f5; padding:20px; }
    .container { background:#fff; padding:20px; border-radius:12px;
                 max-width:1000px; margin:auto; box-shadow:0 4px 12px rgba(0,0,0,.1); }
    textarea, input, button {
      width:100%; margin:6px 0; padding:8px; box-sizing:border-box;
      border-radius:8px; border:1px solid #ccc;
    }
    button { background:#007bff; color:#fff; border:none; cursor:pointer; }
    button:hover { background:#0056b3; }
    .result { font-weight:600; margin-top:12px; }
    table { border-collapse:collapse; margin:10px 0; width:100%; font-size:13px; }
    th, td { border:1px solid #ddd; padding:4px 6px; text-align:right; }
    th { background:#fafafa; }
    .matrix-block { margin:12px 0; padding:10px; border:1px solid #ddd; border-radius:6px; background:#fafafa; }
  </style>
</head>
<body>

<div class="container">
  <h2>Método de Gauss com Matrizes Elementares (L₁·L₂...)</h2>
  <p>Insira a <strong>matriz A</strong> e o <strong>vetor b</strong>. O algoritmo irá construir as matrizes elementares \(L_i\) que transformam \(A\) em triangular superior.</p>

  <label>Matriz A:</label>
  <textarea id="matrizA" rows="5">2 1 -1
-3 -1 2
-2 1 2</textarea>

  <label>Vetor b:</label>
  <input id="vetorB" value="8 -11 -3">

  <label>Precisão (casas decimais):</label>
  <input id="prec" type="number" value="6" min="0" max="12">

  <button onclick="resolver()">Executar</button>

  <div class="result" id="solucao"></div>
  <div id="passos"></div>
</div>

<script>
function parseMatriz(text) {
  return text.trim().split('\n').map(l => l.trim().split(/\s+/).map(Number));
}
function parseVetor(text) {
  return text.trim().split(/\s+/).map(Number);
}
function identidade(n) {
  const I = Array.from({length:n}, (_,i)=>
    Array.from({length:n}, (_,j)=> i===j ? 1 : 0)
  );
  return I;
}
function multiplica(A,B) {
  const n = A.length, m = B[0].length, p = B.length;
  const C = Array.from({length:n}, ()=>Array(m).fill(0));
  for (let i=0;i<n;i++) {
    for (let j=0;j<m;j++) {
      for (let k=0;k<p;k++) C[i][j]+=A[i][k]*B[k][j];
    }
  }
  return C;
}
function gaussMatrizes(Ain, b, prec=6) {
  const n = Ain.length;
  let A = Ain.map(r=>r.slice());
  let Ab = A.map((r,i)=>[...r,b[i]]); // matriz aumentada
  const passos = [];
  
  for (let k=0; k<n-1; k++) {
    if (Math.abs(Ab[k][k])<1e-12) throw new Error("Pivô nulo, precisa pivotear!");
    for (let i=k+1; i<n; i++) {
      const m = Ab[i][k]/Ab[k][k];
      // constrói L
      let L = identidade(n);
      L[i][k] = -m;
      // aplica L
      Ab = multiplica(L, Ab);
      passos.push({k, i, m, L: JSON.parse(JSON.stringify(L)), Ab: JSON.parse(JSON.stringify(Ab))});
    }
  }
  // substituição regressiva
  const U = Ab.map(r=>r.slice(0,n));
  const c = Ab.map(r=>r[n]);
  const x = Array(n).fill(0);
  for (let i=n-1;i>=0;i--){
    let soma=0;
    for (let j=i+1;j<n;j++) soma+=U[i][j]*x[j];
    x[i]=(c[i]-soma)/U[i][i];
  }
  return {passos,x,Ab};
}
function fmt(n, p=6){return Number(n).toFixed(p);}
function renderMatriz(M, prec){
  let html = "<table><tbody>";
  for (const r of M){
    html+="<tr>"+r.map(v=>`<td>${fmt(v,prec)}</td>`).join("")+"</tr>";
  }
  html+="</tbody></table>";
  return html;
}
function resolver(){
  const prec = parseInt(document.getElementById("prec").value||"6");
  try{
    const A = parseMatriz(document.getElementById("matrizA").value);
    const b = parseVetor(document.getElementById("vetorB").value);
    const {passos,x} = gaussMatrizes(A,b,prec);
    document.getElementById("solucao").innerHTML =
      "Solução: "+x.map((v,i)=>`x${i+1}=${fmt(v,prec)}`).join(" ; ");
    let html="";
    passos.forEach((p,idx)=>{
      html+=`<div class="matrix-block"><strong>Passo ${idx+1}:</strong><br>
      Eliminando elemento (i=${p.i+1}, k=${p.k+1}), multiplicador m=${fmt(p.m,prec)}<br>
      Matriz L:<br>${renderMatriz(p.L,prec)}
      Nova matriz aumentada [A|b]:<br>${renderMatriz(p.Ab,prec)}</div>`;
    });
    document.getElementById("passos").innerHTML = html;
  }catch(e){
    document.getElementById("solucao").innerHTML = `<span style="color:red">${e.message}</span>`;
    document.getElementById("passos").innerHTML="";
  }
}
</script>

</body>
</html>
