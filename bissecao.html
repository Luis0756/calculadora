<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<title>Método da Bissecção — Raízes com Etapas</title>
<style>
  :root { font-family: Arial, sans-serif; }
  body { background:#f5f5f5; padding:20px; }
  .container { background:#fff; padding:20px; border-radius:12px;
               max-width:1100px; margin:auto; box-shadow:0 4px 12px rgba(0,0,0,.1); }
  h2 { margin:0 0 10px; }
  label { display:block; margin-top:8px; font-size:14px; }
  input, button { padding:8px; margin-top:4px; width:100%; box-sizing:border-box;
                  border:1px solid #ddd; border-radius:8px; }
  .row { display:grid; grid-template-columns:1fr 1fr; gap:10px; }
  button { background:#7e322e; color:#fff; border:none; cursor:pointer; margin-top:12px; }
  button:hover { background:#7e322e; }
  .result-box { margin-top:12px; font-weight:bold; }
  .warn { color:#b44; font-weight:600; }
  .tabs { margin-top:20px; }
  .tab-buttons { display:flex; gap:8px; margin-bottom:12px; }
  .tab-buttons button { flex:1; background:#eee; color:#000; border:none; padding:8px; cursor:pointer; border-radius:6px; }
  .tab-buttons button.active { background:#7e322e; color:#fff; }
  .tab-content { display:none; background:#f9f9f9; padding:12px; border-radius:6px; }
  .tab-content.active { display:block; }
  table { width:100%; border-collapse:collapse; margin-top:10px; }
  th, td { border:1px solid #ccc; padding:6px; text-align:center; }
  input { background: #faf8eb;}
</style>
</head>
<body>

<div class="container" style="display: flex;">
  <div style="width: 100%;">
    <div style="display: flex; gap:12px; align-items: center;">
      <h2>Método da Bissecção</h2>
      <img src="assets/nana_box.png" height="48px" alt="">
    </div>
  
    <label>Função f(x)</label>
    <input id="func" value="Math.sin(x) - x/2" />
  
    <div class="row">
      <div>
        <label>Intervalo mínimo (xmin)</label>
        <input type="number" id="xmin" value="-10" step="0.1" />
      </div>
      <div>
        <label>Intervalo máximo (xmax)</label>
        <input type="number" id="xmax" value="10" step="0.1" />
      </div>
    </div>
  
    <div class="row">
      <div>
        <label>Passo de varredura (dx)</label>
        <input type="number" id="step" value="1" step="0.1" />
      </div>
      <div>
        <label>Tolerância (intervalo p/ bissecção)</label>
        <input type="number" id="tol" value="0.0001" step="0.0001" />
      </div>
    </div>
  
    <div class="row">
      <div>
        <label>Máx. iterações</label>
        <input type="number" id="maxit" value="100" />
      </div>
    </div>
  
    <button onclick="findRoots()">Encontrar raízes</button>
  
    <div id="out" class="result-box"></div>
  </div>
  <div>
    <img src="assets/nana_bissecao.png" alt="">
    <!-- <img src="https://static.wikia.nocookie.net/vsbattles/images/8/82/Nanachi.png/revision/latest/scale-to-width-down/260?cb=20220923072745" alt=""> -->
  </div>
</div>

<script>
function compileFunction(expr) {
  const cleaned = String(expr).replace(/\^/g, '**');
  try {
    return new Function('x', `with (Math) { return (${cleaned}); }`);
  } catch (e) {
    throw new Error('Não foi possível interpretar a função. Verifique a sintaxe.');
  }
}

function fmt(n) { return Number(n).toFixed(6); }

/* ===== bissecção com registro de etapas ===== */
function bisseccao(f, a, b, tol = 1e-6, maxIter = 100) {
  let fa = f(a), fb = f(b);
  if (fa * fb > 0) return {root:null, steps:[]};
  let iter = 0, c, fc;
  let steps = [];
  while ((b - a)/2 > tol && iter < maxIter) {
    c = (a+b)/2;
    fc = f(c);
    steps.push({iter:iter+1, a:a, b:b, c:c, fc:fc});
    if (fc === 0) break;
    if (fa*fc < 0) { b=c; fb=fc; } else { a=c; fa=fc; }
    iter++;
  }
  return {root:(a+b)/2, steps:steps};
}

function findRoots() {
  try {
    const f = compileFunction(document.getElementById('func').value);
    const xmin = parseFloat(document.getElementById('xmin').value);
    const xmax = parseFloat(document.getElementById('xmax').value);
    const step = parseFloat(document.getElementById('step').value);
    const tol = parseFloat(document.getElementById('tol').value);
    const maxit = parseInt(document.getElementById('maxit').value, 10);

    if (!(isFinite(xmin) && isFinite(xmax) && isFinite(step) && step>0)) throw new Error('Intervalo inválido ou passo não positivo.');
    if (xmin>=xmax) throw new Error('xmin deve ser < xmax.');

    const fzeroTol = Math.max(1e-12,1e-8);
    const mergeTol = Math.max(tol*10,1e-8);
    let roots = [];
    let stepsPerRoot = [];
    let x = xmin;

    while(x < xmax-1e-15){
      const a = x;
      const b = Math.min(x+step, xmax);
      let fa = f(a); if(!isFinite(fa)){x=b; continue;}
      if(Math.abs(fa)<=fzeroTol){ if(!roots.some(rr=>Math.abs(rr-a)<=mergeTol)){ roots.push(a); stepsPerRoot.push([]); } x=b; continue;}
      let fb = f(b); if(!isFinite(fb)){x=b; continue;}
      if(Math.abs(fb)<=fzeroTol){ if(!roots.some(rr=>Math.abs(rr-b)<=mergeTol)){ roots.push(b); stepsPerRoot.push([]); } x=b; continue;}
      if(fa*fb<0){
        const res = bisseccao(f,a,b,tol,maxit);
        if(res.root!==null && isFinite(res.root)){
          if(!roots.some(rr=>Math.abs(rr-res.root)<=mergeTol)){
            roots.push(res.root);
            stepsPerRoot.push(res.steps);
          }
        }
      }
      x=b;
    }

    roots.sort((u,v)=>u-v);
    stepsPerRoot = stepsPerRoot.sort((a,b,i=0)=>roots[i++]-roots[i]);
    
    const merged = [];
    const mergedSteps = [];
    for(let i=0;i<roots.length;i++){
      const r = roots[i];
      const s = stepsPerRoot[i];
      if(merged.length===0){ merged.push(r); mergedSteps.push(s); }
      else{
        const last = merged[merged.length-1];
        if(Math.abs(r-last)<=mergeTol){ merged[merged.length-1]=(last+r)/2; }
        else{ merged.push(r); mergedSteps.push(s); }
      }
    }

    if(merged.length===0){ document.getElementById('out').innerHTML="<span class='warn'>Nenhuma raiz encontrada no intervalo.</span>"; return; }

    // ===== criar tabs =====
    let html = `<div class="tabs">`;
    html += `<div class="tab-buttons">`;
    merged.forEach((r,i)=>{ html += `<button onclick="showTab(${i})" id="tabbtn${i}" ${i===0?'class="active"':''}>Raiz ${i+1}: ${fmt(r)}</button>`; });
    html += `</div>`;
    merged.forEach((r,i)=>{
      html += `<div class="tab-content ${i===0?'active':''}" id="tab${i}">`;
      html += `<table><tr><th>Iter</th><th>a</th><th>b</th><th>c</th><th>f(c)</th></tr>`;
      const steps = stepsPerRoot[i];
      if(steps.length===0){ html += `<tr><td colspan="5">Raiz encontrada nos extremos do subintervalo.</td></tr>`; }
      steps.forEach(s=>{
        html += `<tr><td>${s.iter}</td><td>${fmt(s.a)}</td><td>${fmt(s.b)}</td><td>${fmt(s.c)}</td><td>${fmt(s.fc)}</td></tr>`;
      });
      html += `</table></div>`;
    });
    html += `</div>`;
    document.getElementById('out').innerHTML = html;
  } catch(e){ document.getElementById('out').innerHTML=`<span class='warn'>${e.message}</span>`; }
}

// ===== controle de tabs =====
function showTab(i){
  const tabs = document.querySelectorAll('.tab-content');
  const buttons = document.querySelectorAll('.tab-buttons button');
  tabs.forEach((t,j)=>{ t.classList.toggle('active', j===i); buttons[j].classList.toggle('active', j===i); });
}
</script>
</body>
</html>
